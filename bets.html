<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Live NFL Bet Tracker</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        :root {
            --primary: #00338d; --secondary: #d50a0a; --dark: #1a1a1a; --light: #f8f9fa;
            --success: #28a745; --warning: #ffc107; --danger: #dc3545; --gray: #6c757d;
        }
        body {
            background: linear-gradient(135deg, #0c2340 0%, #1a3a5f 100%);
            color: var(--light); min-height: 100vh; padding: 20px;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        header { text-align: center; padding: 20px 0; margin-bottom: 30px; }
        header h1 {
            font-size: 2.8rem; margin-bottom: 10px;
            background: linear-gradient(to right, var(--secondary), var(--primary));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        header p { color: #a0c4e8; font-size: 1.1rem; max-width: 600px; margin: 0 auto; }
        .app-container { display: flex; flex-wrap: wrap; gap: 25px; margin-bottom: 30px; }
        .card {
            background: rgba(25, 40, 65, 0.85); border-radius: 12px; padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3); backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }
        .form-container { flex: 1; min-width: 300px; }
        .stats-container { flex: 2; min-width: 300px; }
        .card-title {
            font-size: 1.5rem; margin-bottom: 20px; padding-bottom: 15px;
            border-bottom: 2px solid var(--primary); display: flex; align-items: center; gap: 10px;
        }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: 600; color: #e0e7ff; }
        select, input {
            width: 100%; padding: 12px 15px; border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.2); background: rgba(10,20,40,0.7);
            color: white; font-size: 1rem;
        }
        select:focus, input:focus {
            outline: none; border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0,51,141,0.3);
        }
        .btn {
            background: linear-gradient(to right, var(--primary), #0055b3); color: white; border: none;
            padding: 12px 25px; border-radius: 8px; font-size: 1.1rem; font-weight: 600;
            cursor: pointer; transition: all 0.3s ease; width: 100%;
            display: flex; justify-content: center; align-items: center; gap: 8px;
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,51,141,0.4); }
        .stats-display { background: rgba(10,20,40,0.7); border-radius: 10px; padding: 20px; min-height: 250px; }
        .live-indicator {
            display: flex; align-items: center; gap: 8px; margin-bottom: 20px;
            padding: 10px; background: rgba(213,10,10,0.2); border-radius: 8px; font-weight: 600;
        }
        .live-dot {
            width: 12px; height: 12px; background: var(--danger); border-radius: 50%;
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.4; } 100% { opacity: 1; } }
        .stat-item { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .stat-label { color: var(--gray); }
        .stat-value { font-weight: 700; font-size: 1.2rem; }
        .bet-card { background: rgba(0,51,141,0.3); border-radius: 10px; padding: 18px; margin-top: 15px; border-left: 4px solid var(--secondary); }
        .bet-status { font-size: 0.9rem; padding: 4px 10px; border-radius: 20px; }
        .success { background: var(--success); }
        .danger { background: var(--danger); }
        .pending { background: var(--warning); color: var(--dark); }
        .refresh-info { text-align: center; margin-top: 15px; color: #a0c4e8; font-size: 0.9rem; }
        .no-games { text-align: center; padding: 30px; color: var(--gray); }
        .no-games i { font-size: 3rem; margin-bottom: 15px; opacity: 0.5; }
        footer { text-align: center; padding: 20px; color: #a0c4e8; font-size: 0.9rem; }
        @media (max-width: 768px) {
            .app-container { flex-direction: column; }
            header h1 { font-size: 2.2rem; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-football-ball"></i> Live NFL Bet Tracker</h1>
            <p>Real-time stats from API-Sports • Updates every 30 seconds</p>
        </header>
        
        <div class="app- container">
            <div class="card form-container">
                <h2 class="card-title"><i class="fas fa-plus-circle"></i> Add Your Bet</h2>
                <div class="form-group">
                    <label for="gameSelect">Select Live Game</label>
                    <select id="gameSelect" disabled>
                        <option value="">Loading live games...</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="playerSelect">Select Player</label>
                    <select id="playerSelect" disabled>
                        <option value="">Select a game first</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="statType">Stat Type</label>
                    <select id="statType" disabled>
                        <option value="">Select a player first</option>
                        <option value="rushing_yards">Rushing Yards</option>
                        <option value="passing_yards">Passing Yards</option>
                        <option value="receiving_yards">Receiving Yards</option>
                        <option value="touchdowns">Touchdowns</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="betAmount">Bet Amount ($)</label>
                    <input type="number" id="betAmount" placeholder="e.g., 50" min="1" step="1" disabled>
                </div>
                
                <div class="form-group">
                    <label for="statThreshold">Stat Threshold</label>
                    <input type="number" id="statThreshold" placeholder="e.g., 85" min="1" step="1" disabled>
                </div>
                
                <button id="addBetBtn" class="btn" disabled>
                    <i class="fas fa-plus"></i> Add Bet
                </button>
            </div>
            
            <div class="card stats-container">
                <h2 class="card-title"><i class="fas fa-chart-line"></i> Live Game Stats</h2>
                <div class="stats-display" id="statsDisplay">
                    <div class="no-games">
                        <i class="fas fa-tv"></i>
                        <h3>Checking for live games...</h3>
                        <p>Live games appear only during NFL season</p>
                    </div>
                </div>
                <div class="refresh-info">
                    Stats update every <strong>30 seconds</strong> • Next update in <span id="countdown">30</span>s
                </div>
            </div>
        </div>
        
        <div class="card" id="betsContainer" style="display: none;">
            <h2 class="card-title"><i class="fas fa-list"></i> Your Active Bets</h2>
            <div id="betsList"></div>
        </div>
        
        <footer>
            <p>Data from API-Sports via RapidAPI</p>
            <p style="color:#ff6b6b; margin-top:8px; font-size:0.85rem;">
                ⚠️ WARNING: This file contains a live API key. 
                For production, move to a backend proxy to avoid key exposure.
            </p>
        </footer>
    </div>

    <script>
        // ✅ LIVE API KEY INSERTED (from your provided key)
        const RAPIDAPI_KEY = "f0da70b6b6mshd658d978bfbedf0p1113b0jsn5672bc067fbb";
        
        // Configuration
        const API_HOST = "api-nflv1.p.rapidapi.com";
        const SEASON = new Date().getFullYear(); // Current NFL season
        const TEAM_ID_MAP = {}; // Will be populated from teams endpoint
        
        // State
        let liveGames = [];
        let selectedGameId = null;
        let userBets = [];
        let countdown = 30;
        
        // DOM Elements
        const gameSelect = document.getElementById('gameSelect');
        const playerSelect = document.getElementById('playerSelect');
        const statType = document.getElementById('statType');
        const betAmount = document.getElementById('betAmount');
        const statThreshold = document.getElementById('statThreshold');
        const addBetBtn = document.getElementById('addBetBtn');
        const statsDisplay = document.getElementById('statsDisplay');
        const betsContainer = document.getElementById('betsContainer');
        const betsList = document.getElementById('betsList');
        const countdownElement = document.getElementById('countdown');
        
        // Initialize
        async function initApp() {
            await loadTeams(); // Needed for player lookup
            await fetchLiveGames();
            setupEventListeners();
            startAutoRefresh();
        }
        
        // Fetch all NFL teams (needed to map team IDs to names for players)
        async function loadTeams() {
            try {
                const res = await fetch(`https://${API_HOST}/v1/teams?league=1`, {
                    headers: {
                        "X-RapidAPI-Key": RAPIDAPI_KEY,
                        "X-RapidAPI-Host": API_HOST
                    }
                });
                const data = await res.json();
                data.response.forEach(team => {
                    TEAM_ID_MAP[team.id] = team.name;
                });
            } catch (err) {
                console.error("Failed to load teams:", err);
            }
        }
        
        // Fetch live or today's games
        async function fetchLiveGames() {
            const today = new Date().toISOString().split('T')[0]; // YYYY-MM-DD
            
            try {
                const res = await fetch(`https://${API_HOST}/v1/games?date=${today}&league=1&season=${SEASON}`, {
                    headers: {
                        "X-RapidAPI-Key": RAPIDAPI_KEY,
                        "X-RapidAPI-Host": API_HOST
                    }
                });
                const data = await res.json();
                
                // Filter for live or pre-game today
                liveGames = data.response.filter(game => 
                    ['LIVE', 'HT', '1H', '2H', '3Q', '4Q', 'OT'].includes(game.status.short) ||
                    game.status.short === 'NS' // Not Started (today)
                );
                
                renderGameDropdown();
                if (liveGames.length > 0) {
                    renderLiveStats(liveGames[0].id);
                }
            } catch (err) {
                console.error("Error fetching games:", err);
                statsDisplay.innerHTML = `<div class="no-games">
                    <i class="fas fa-exclamation-triangle"></i>
                    <h3>Failed to load games</h3>
                    <p>Check console for errors</p>
                </div>`;
            }
        }
        
        // Render game dropdown
        function renderGameDropdown() {
            gameSelect.innerHTML = '';
            
            if (liveGames.length === 0) {
                gameSelect.innerHTML = '<option value="">No live games today</option>';
                gameSelect.disabled = true;
                return;
            }
            
            liveGames.forEach(game => {
                const option = document.createElement('option');
                const status = game.status.short === 'NS' ? 'Today' : 'LIVE';
                option.value = game.id;
                option.textContent = `${game.teams.away.name} @ ${game.teams.home.name} - ${status}`;
                gameSelect.appendChild(option);
            });
            
            gameSelect.disabled = false;
            gameSelect.addEventListener('change', handleGameChange);
        }
        
        // Handle game selection
        async function handleGameChange() {
            selectedGameId = gameSelect.value;
            if (!selectedGameId) return;
            
            // Fetch players for this game
            await fetchGamePlayers(selectedGameId);
            renderLiveStats(selectedGameId);
        }
        
        // Fetch players for a game
        async function fetchGamePlayers(gameId) {
            try {
                const res = await fetch(`https://${API_HOST}/v1/games/players?id=${gameId}`, {
                    headers: {
                        "X-RapidAPI-Key": RAPIDAPI_KEY,
                        "X-RapidAPI-Host": API_HOST
                    }
                });
                const data = await res.json();
                renderPlayerDropdown(data.response);
            } catch (err) {
                console.error("Error fetching players:", err);
            }
        }
        
        // Render player dropdown
        function renderPlayerDropdown(playersData) {
            playerSelect.innerHTML = '';
            
            if (!playersData || playersData.length === 0) {
                playerSelect.innerHTML = '<option value="">No players found</option>';
                playerSelect.disabled = true;
                return;
            }
            
            // Combine home and away players
            const allPlayers = [];
            if (playersData[0]?.players?.away) allPlayers.push(...playersData[0].players.away);
            if (playersData[0]?.players?.home) allPlayers.push(...playersData[0].players.home);
            
            // Filter players with stats
            const activePlayers = allPlayers.filter(p => 
                (p.statistics[0]?.rushing?.yards > 0 || 
                 p.statistics[0]?.passing?.yards > 0 || 
                 p.statistics[0]?.receiving?.yards > 0 ||
                 p.statistics[0]?.touchdowns?.total > 0)
            );
            
            if (activePlayers.length === 0) {
                playerSelect.innerHTML = '<option value="">No stats yet</option>';
                playerSelect.disabled = true;
                return;
            }
            
            activePlayers.forEach(player => {
                const option = document.createElement('option');
                option.value = player.id;
                option.textContent = `${player.name} (${TEAM_ID_MAP[player.team.id] || player.team.name})`;
                playerSelect.appendChild(option);
            });
            
            playerSelect.disabled = false;
            enableFormIfValid();
        }
        
        function enableFormIfValid() {
            const gameSelected = gameSelect.value !== '';
            const playerSelected = playerSelect.value !== '';
            
            statType.disabled = !playerSelected;
            betAmount.disabled = !playerSelected;
            statThreshold.disabled = !playerSelected;
            addBetBtn.disabled = !(gameSelected && playerSelected);
        }
        
        // Render live stats for game
        async function renderLiveStats(gameId) {
            if (!gameId) return;
            
            const game = liveGames.find(g => g.id == gameId);
            if (!game) return;
            
            // Fetch fresh game data
            let currentGame;
            try {
                const res = await fetch(`https://${API_HOST}/v1/games?id=${gameId}`, {
                    headers: {
                        "X-RapidAPI-Key": RAPIDAPI_KEY,
                        "X-RapidAPI-Host": API_HOST
                    }
                });
                const data = await res.json();
                currentGame = data.response[0];
            } catch (err) {
                console.error("Error fetching game:", err);
                return;
            }
            
            // Fetch players stats
            let playersData = [];
            try {
                const res = await fetch(`https://${API_HOST}/v1/games/players?id=${gameId}`, {
                    headers: {
                        "X-RapidAPI-Key": RAPIDAPI_KEY,
                        "X-RapidAPI-Host": API_HOST
                    }
                });
                const data = await res.json();
                playersData = data.response;
            } catch (err) {
                console.error("Error fetching players:", err);
            }
            
            // Build stats display
            let statsHTML = `
                <div class="live-indicator">
                    <div class="live-dot"></div>
                    LIVE: ${currentGame.teams.away.name} @ ${currentGame.teams.home.name}
                </div>
                <div class="stat-item">
                    <span class="stat-label">Score</span>
                    <span class="stat-value">${currentGame.scores.away.total} - ${currentGame.scores.home.total}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Status</span>
                    <span class="stat-value">${currentGame.status.long}</span>
                </div>
            `;
            
            if (playersData.length > 0) {
                statsHTML += `<div style="margin-top:20px;"><h3 style="margin-bottom:15px;color:var(--secondary);">Live Player Stats</h3>`;
                
                const allPlayers = [];
                if (playersData[0]?.players?.away) allPlayers.push(...playersData[0].players.away);
                if (playersData[0]?.players?.home) allPlayers.push(...playersData[0].players.home);
                
                // Show top performers
                const topPlayers = allPlayers
                    .filter(p => p.statistics[0])
                    .sort((a, b) => {
                        const aYards = (a.statistics[0].rushing?.yards || 0) + 
                                      (a.statistics[0].passing?.yards || 0) + 
                                      (a.statistics[0].receiving?.yards || 0);
                        const bYards = (b.statistics[0].rushing?.yards || 0) + 
                                      (b.statistics[0].passing?.yards || 0) + 
                                      (b.statistics[0].receiving?.yards || 0);
                        return bYards - aYards;
                    })
                    .slice(0, 8); // Top 8 players
                
                topPlayers.forEach(p => {
                    const stats = p.statistics[0];
                    const rush = stats.rushing?.yards || 0;
                    const pass = stats.passing?.yards || 0;
                    const rec = stats.receiving?.yards || 0;
                    const tds = stats.touchdowns?.total || 0;
                    
                    let statStr = "";
                    if (rush > 0) statStr += `${rush} RUSH • `;
                    if (pass > 0) statStr += `${pass} PASS • `;
                    if (rec > 0) statStr += `${rec} REC • `;
                    if (tds > 0) statStr += `${tds} TD`;
                    
                    statsHTML += `
                        <div class="stat-item">
                            <span class="stat-label">${p.name}</span>
                            <span class="stat-value">${statStr || "No stats yet"}</span>
                        </div>
                    `;
                });
                
                statsHTML += `</div>`;
            }
            
            statsDisplay.innerHTML = statsHTML;
            
            // Update bets with new stats
            updateBetStatuses(playersData);
        }
        
        // Add bet
        function addBet() {
            const gameId = gameSelect.value;
            const playerId = playerSelect.value;
            const stat = statType.value;
            const amount = parseFloat(betAmount.value);
            const threshold = parseFloat(statThreshold.value);
            
            if (!gameId || !playerId || !stat || isNaN(amount) || isNaN(threshold)) {
                alert('Please fill all fields');
                return;
            }
            
            const game = liveGames.find(g => g.id == gameId);
            const playerName = playerSelect.options[playerSelect.selectedIndex].text.split(' (')[0];
            
            userBets.push({
                id: Date.now(),
                gameId,
                playerId,
                playerName,
                stat,
                threshold,
                amount,
                status: 'pending'
            });
            
            renderBets();
            
            // Reset form
            betAmount.value = '';
            statThreshold.value = '';
        }
        
        // Update bet statuses
        function updateBetStatuses(playersData) {
            if (!playersData || playersData.length === 0) return;
            
            const allPlayers = [];
            if (playersData[0]?.players?.away) allPlayers.push(...playersData[0].players.away);
            if (playersData[0]?.players?.home) allPlayers.push(...playersData[0].players.home);
            
            userBets.forEach(bet => {
                const player = allPlayers.find(p => p.id == bet.playerId);
                if (!player || !player.statistics[0]) return;
                
                const stats = player.statistics[0];
                let currentValue = 0;
                
                switch(bet.stat) {
                    case 'rushing_yards': currentValue = stats.rushing?.yards || 0; break;
                    case 'passing_yards': currentValue = stats.passing?.yards || 0; break;
                    case 'receiving_yards': currentValue = stats.receiving?.yards || 0; break;
                    case 'touchdowns': currentValue = stats.touchdowns?.total || 0; break;
                }
                
                const game = liveGames.find(g => g.id == bet.gameId);
                const isGameOver = game && ['FT', 'AOT'].includes(game.status.short);
                
                if (currentValue >= bet.threshold) {
                    bet.status = 'winning';
                } else if (isGameOver) {
                    bet.status = 'lost';
                } else {
                    bet.status = 'pending';
                }
            });
            
            renderBets();
        }
        
        // Render user bets
        function renderBets() {
            if (userBets.length === 0) {
                betsContainer.style.display = 'none';
                return;
            }
            
            betsContainer.style.display = 'block';
            betsList.innerHTML = '';
            
            userBets.forEach(bet => {
                const statusClass = bet.status === 'winning' ? 'success' : 
                                   bet.status === 'lost' ? 'danger' : 'pending';
                const statusText = bet.status === 'winning' ? 'Winning' : 
                                  bet.status === 'lost' ? 'Lost' : 'Pending';
                
                const betEl = document.createElement('div');
                betEl.className = 'bet-card';
                betEl.innerHTML = `
                    <div class="bet-header">
                        <h3>${bet.playerName}</h3>
                        <span class="bet-status ${statusClass}">${statusText}</span>
                    </div>
                    <p><strong>Bet:</strong> $${bet.amount} on ${bet.threshold}+ ${bet.stat.replace('_', ' ')}</p>
                `;
                betsList.appendChild(betEl);
            });
        }
        
        // Set up event listeners
        function setupEventListeners() {
            gameSelect.addEventListener('change', handleGameChange);
            playerSelect.addEventListener('change', enableFormIfValid);
            addBetBtn.addEventListener('click', addBet);
        }
        
        // Auto-refresh every 30 seconds
        function startAutoRefresh() {
            countdownElement.textContent = countdown;
            const timer = setInterval(() => {
                countdown--;
                countdownElement.textContent = countdown;
                
                if (countdown <= 0) {
                    countdown = 30;
                    fetchLiveGames(); // Refresh games list
                    if (selectedGameId) {
                        renderLiveStats(selectedGameId); // Refresh stats
                    }
                }
            }, 1000);
        }
        
        // Start when DOM loaded
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>

