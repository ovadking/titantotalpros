<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NFL Intel Pro | Selectable Matchups</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .prop-card { transition: all 0.2s; border: 1px solid #1e293b; }
        .prop-card:hover { border-color: #3b82f6; background: #0f172a; transform: translateY(-2px); }
        .custom-select { appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%233b82f6'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 0.75rem center; background-size: 1rem; }
    </style>
</head>
<body class="bg-[#020617] text-slate-100 font-sans min-h-screen">

    <nav class="sticky top-0 z-50 bg-slate-900/90 backdrop-blur-xl border-b border-slate-800 p-4">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <h1 class="text-xl font-black tracking-tighter text-blue-500 italic uppercase">
                Intel<span class="text-white">Props</span>
            </h1>
            <div id="status-display" class="text-right">
                <p class="text-[10px] font-bold text-slate-500 uppercase">Live Connection</p>
                <p class="text-xs text-green-400 font-mono" id="last-updated">Ready</p>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto p-4 md:p-8">
        <div class="mb-10 bg-slate-900/40 p-6 rounded-3xl border border-slate-800 shadow-2xl">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-6">
                <div class="w-full md:w-1/2">
                    <label class="block text-[10px] font-black text-blue-500 uppercase tracking-widest mb-2 ml-1">Choose an Upcoming Game</label>
                    <select id="game-selector" onchange="handleGameSelection()" class="custom-select w-full bg-slate-950 border border-slate-700 text-white py-3 px-4 rounded-xl font-bold focus:ring-2 focus:ring-blue-600 outline-none transition-all">
                        <option value="">Loading upcoming matchups...</option>
                    </select>
                </div>
                <div class="flex gap-2">
                    <button onclick="fetchUpcomingGames()" class="bg-slate-800 hover:bg-slate-700 text-white px-6 py-3 rounded-xl text-xs font-black transition">REFRESH GAMES</button>
                    <button onclick="handleGameSelection()" id="sync-btn" class="hidden bg-blue-600 hover:bg-blue-500 text-white px-6 py-3 rounded-xl text-xs font-black transition">SYNC PROPS</button>
                </div>
            </div>
        </div>

        <div id="prop-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-5">
            <div class="col-span-full py-20 text-center opacity-40">
                <p class="text-sm italic">Please select a game from the list above to view performance predictions.</p>
            </div>
        </div>
    </main>

    <script>
        const API_KEY = 'efdf341994d00e05a9e8bb18fb3ec8ea'; 
        const SPORT = 'americanfootball_nfl';
        const REGION = 'us';
        const MARKETS = 'player_pass_yds,player_rush_yds,player_receptions';

        const seasonStats = {
            "Dak Prescott": 280.1, "Jared Goff": 264.6, "Derrick Henry": 83.5, 
            "James Cook": 102.1, "Nico Collins": 88.4, "Justin Herbert": 232.7,
            "C.J. Stroud": 265.0, "Saquon Barkley": 88.5, "Lamar Jackson": 210.5
        };

        // 1. Initial Load: Fetch all game IDs and Names
        async function fetchUpcomingGames() {
            const selector = document.getElementById('game-selector');
            try {
                const res = await fetch(`https://api.the-odds-api.com/v4/sports/${SPORT}/events?apiKey=${API_KEY}`);
                const events = await res.json();
                
                selector.innerHTML = '<option value="" disabled selected>-- Select Matchup --</option>';
                events.forEach(event => {
                    const option = document.createElement('option');
                    option.value = event.id;
                    option.dataset.home = event.home_team;
                    option.dataset.away = event.away_team;
                    option.textContent = `${event.away_team} @ ${event.home_team} (${new Date(event.commence_time).toLocaleDateString()})`;
                    selector.appendChild(option);
                });
                document.getElementById('last-updated').innerText = 'Games Loaded';
            } catch (err) {
                selector.innerHTML = '<option value="">Error loading games</option>';
            }
        }

        // 2. Game Selection Logic
        async function handleGameSelection() {
            const eventId = document.getElementById('game-selector').value;
            if (!eventId) return;

            const grid = document.getElementById('prop-grid');
            grid.innerHTML = '<div class="col-span-full py-20 text-center animate-pulse text-blue-500 font-black italic">FETCHING PROP DATA...</div>';

            try {
                const res = await fetch(`https://api.the-odds-api.com/v4/sports/${SPORT}/events/${eventId}/odds?apiKey=${API_KEY}&regions=${REGION}&markets=${MARKETS}&oddsFormat=american`);
                const data = await res.json();
                
                grid.innerHTML = '';
                if (!data.bookmakers.length) {
                    grid.innerHTML = '<p class="col-span-full text-center py-20 text-slate-500">No prop markets available for this game yet.</p>';
                    return;
                }

                data.bookmakers[0].markets.forEach(market => {
                    market.outcomes.forEach(outcome => {
                        if (outcome.name === 'Over') renderCard(data, outcome, market.key);
                    });
                });
                
                document.getElementById('last-updated').innerText = `Synced: ${new Date().toLocaleTimeString()}`;
            } catch (err) {
                grid.innerHTML = `<p class="col-span-full text-center text-red-500">Error: ${err.message}</p>`;
            }
        }

        function renderCard(event, prop, marketKey) {
            const grid = document.getElementById('prop-grid');
            const avg = seasonStats[prop.description] || (prop.point * 0.98);
            const edge = (((avg - prop.point) / prop.point) * 100).toFixed(1);

            grid.innerHTML += `
                <div class="prop-card bg-slate-900/40 rounded-3xl p-6 flex flex-col justify-between">
                    <div>
                        <div class="flex justify-between items-center mb-4">
                            <span class="text-[9px] font-bold text-slate-500 uppercase italic">Prediction Engine</span>
                            <span class="text-[9px] font-bold text-blue-500 uppercase tracking-widest">${marketKey.replace('player_', '').replace('_', ' ')}</span>
                        </div>
                        <h3 class="text-xl font-black text-white leading-tight mb-4">${prop.description}</h3>
                        <div class="grid grid-cols-2 gap-3 mb-6">
                            <div class="bg-black/30 p-3 rounded-2xl border border-slate-800">
                                <p class="text-[9px] text-slate-500 font-bold uppercase mb-1">Market Line</p>
                                <p class="text-lg font-mono font-bold">${prop.point}</p>
                            </div>
                            <div class="bg-blue-600/10 p-3 rounded-2xl border border-blue-900/30">
                                <p class="text-[9px] text-blue-400 font-bold uppercase mb-1">Season Avg</p>
                                <p class="text-lg font-mono font-bold text-blue-400">${avg.toFixed(1)}</p>
                            </div>
                        </div>
                    </div>
                    <div class="pt-4 border-t border-slate-800/50 flex justify-between items-center">
                        <div>
                            <p class="text-[9px] text-slate-500 font-bold uppercase mb-1">Model Edge</p>
                            <p class="text-2xl font-black italic tracking-tighter ${edge > 0 ? 'text-green-400' : 'text-red-400'}">${edge}%</p>
                        </div>
                        <span class="bg-white text-black px-4 py-1.5 rounded-lg text-[11px] font-black italic uppercase">${edge > 0 ? 'OVER' : 'UNDER'}</span>
                    </div>
                </div>
            `;
        }

        fetchUpcomingGames();
    </script>
</body>
</html>
