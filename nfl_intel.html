<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NFL Intel Pro | Probability Engine</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .prob-bar { transition: width 1.5s ease-in-out; }
        .card-glow:hover { box-shadow: 0 0 20px rgba(59, 130, 246, 0.3); border-color: #3b82f6; }
    </style>
</head>
<body class="bg-[#020617] text-slate-100 font-sans min-h-screen">

    <nav class="sticky top-0 z-50 bg-slate-900/90 backdrop-blur-xl border-b border-slate-800 p-4">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <h1 class="text-xl font-black tracking-tighter text-blue-500 italic uppercase">
                Intel<span class="text-white">Prob</span>
            </h1>
            <div id="status-display" class="text-right">
                <p class="text-[10px] font-bold text-slate-500 uppercase">Season Logic</p>
                <p class="text-xs text-green-400 font-mono" id="last-updated">Normal Distribution Active</p>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto p-4 md:p-8">
        <div class="mb-10 bg-slate-900/40 p-6 rounded-3xl border border-slate-800 shadow-2xl">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-6">
                <div class="w-full md:w-1/2">
                    <label class="block text-[10px] font-black text-blue-500 uppercase tracking-widest mb-2 ml-1">Live Matchup Analysis</label>
                    <select id="game-selector" onchange="handleGameSelection()" class="w-full bg-slate-950 border border-slate-700 text-white py-3 px-4 rounded-xl font-bold focus:ring-2 focus:ring-blue-600 outline-none transition-all">
                        <option value="">-- Scanning Week 17 Schedule --</option>
                    </select>
                </div>
                <div class="text-xs text-slate-500 italic max-w-xs text-right">
                    Probabilities calculated via Z-score analysis using 2025 seasonal variance.
                </div>
            </div>
        </div>

        <div id="prop-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            <div class="col-span-full py-20 text-center opacity-40">
                <p class="text-sm italic">Select a game to run the probability model.</p>
            </div>
        </div>
    </main>

    <script>
        const API_KEY = 'efdf341994d00e05a9e8bb18fb3ec8ea'; 
        const SPORT = 'americanfootball_nfl';
        const REGION = 'us';
        const MARKETS = 'player_pass_yds,player_rush_yds,player_receptions';

        // 2025 LATEST AVERAGES & STANDARD DEVIATIONS (Variance)
        const playerModels = {
            "Dak Prescott": { avg: 280.1, stdev: 45.0 },
            "Matthew Stafford": { avg: 278.6, stdev: 52.0 },
            "James Cook": { avg: 102.1, stdev: 28.0 },
            "Jonathan Taylor": { avg: 99.2, stdev: 24.5 },
            "Derrick Henry": { avg: 83.5, stdev: 18.0 },
            "Jaxon Smith-Njigba": { avg: 102.3, stdev: 31.0 },
            "Justin Herbert": { avg: 232.7, stdev: 41.0 },
            "Saquon Barkley": { avg: 88.5, stdev: 22.0 }
        };

        // Math: Z-Score to Cumulative Normal Distribution (Rough approximation)
        function getProbability(mean, stdev, line) {
            const z = (line - mean) / stdev;
            const prob = 0.5 * (1 + erf(-z / Math.sqrt(2)));
            return (prob * 100).toFixed(1);
        }

        // Error function approximation for probability math
        function erf(x) {
            const a1 = 0.254829592, a2 = -0.284496736, a3 = 1.421413741, a4 = -1.453152027, a5 = 1.061405429, p = 0.3275911;
            const sign = (x < 0) ? -1 : 1;
            x = Math.abs(x);
            const t = 1.0 / (1.0 + p * x);
            const y = 1.0 - (((((a5 * t + a4) * t) + a3) * t + a2) * t + a1) * t * Math.exp(-x * x);
            return sign * y;
        }

        async function fetchUpcomingGames() {
            const selector = document.getElementById('game-selector');
            try {
                const res = await fetch(`https://api.the-odds-api.com/v4/sports/${SPORT}/events?apiKey=${API_KEY}`);
                const events = await res.json();
                selector.innerHTML = '<option value="" disabled selected>-- Select Matchup --</option>';
                events.forEach(event => {
                    const option = document.createElement('option');
                    option.value = event.id;
                    option.textContent = `${event.away_team} @ ${event.home_team}`;
                    selector.appendChild(option);
                });
            } catch (err) { selector.innerHTML = '<option value="">Error Loading Games</option>'; }
        }

        async function handleGameSelection() {
            const eventId = document.getElementById('game-selector').value;
            if (!eventId) return;
            const grid = document.getElementById('prop-grid');
            grid.innerHTML = '<div class="col-span-full text-center py-20 text-blue-500 font-bold">RUNNING SIMULATIONS...</div>';

            try {
                const res = await fetch(`https://api.the-odds-api.com/v4/sports/${SPORT}/events/${eventId}/odds?apiKey=${API_KEY}&regions=${REGION}&markets=${MARKETS}&oddsFormat=american`);
                const data = await res.json();
                grid.innerHTML = '';
                if (!data.bookmakers.length) {
                    grid.innerHTML = '<p class="col-span-full text-center py-20 text-slate-500">No prop data yet.</p>';
                    return;
                }
                data.bookmakers[0].markets.forEach(market => {
                    market.outcomes.forEach(outcome => {
                        if (outcome.name === 'Over') renderCard(outcome, market.key);
                    });
                });
            } catch (err) { grid.innerHTML = `<p class="col-span-full text-center">Error: ${err.message}</p>`; }
        }

        function renderCard(prop, marketKey) {
            const grid = document.getElementById('prop-grid');
            const model = playerModels[prop.description] || { avg: prop.point, stdev: prop.point * 0.2 };
            const hitProb = getProbability(model.avg, model.stdev, prop.point);
            const colorClass = hitProb > 55 ? 'text-green-400' : (hitProb < 45 ? 'text-red-400' : 'text-slate-400');

            grid.innerHTML += `
                <div class="card-glow bg-slate-900/60 rounded-3xl p-6 flex flex-col justify-between border border-slate-800">
                    <div>
                        <div class="flex justify-between items-center mb-4">
                            <span class="text-[9px] font-bold text-blue-500 uppercase tracking-widest">${marketKey.replace('player_', '').replace('_', ' ')}</span>
                            <span class="text-[9px] font-bold text-slate-600 uppercase">Live Odds</span>
                        </div>
                        <h3 class="text-xl font-black text-white leading-tight mb-2">${prop.description}</h3>
                        <p class="text-xs text-slate-500 mb-6 font-medium">Line: <span class="text-white">${prop.point}</span> | Avg: ${model.avg.toFixed(1)}</p>
                    </div>

                    <div class="space-y-4">
                        <div class="flex justify-between items-end">
                            <p class="text-[10px] font-bold text-slate-500 uppercase">Hit Probability</p>
                            <p class="text-3xl font-black italic tracking-tighter ${colorClass}">${hitProb}%</p>
                        </div>
                        <div class="w-full bg-slate-800 h-2 rounded-full overflow-hidden">
                            <div class="prob-bar h-full rounded-full bg-blue-600" style="width: ${hitProb}%"></div>
                        </div>
                        <p class="text-[10px] text-center text-slate-600 italic">Expected Value: ${hitProb > 52.4 ? 'Positive (+EV)' : 'Negative (-EV)'}</p>
                    </div>
                </div>
            `;
        }

        fetchUpcomingGames();
    </script>
</body>
</html>
